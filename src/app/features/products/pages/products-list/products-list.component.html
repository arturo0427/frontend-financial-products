<section class="page">
  <header class="page__header">
    <h1 class="title">Productos Financieros</h1>

    <button class="btn btn--primary" type="button" (click)="goToCreate()">
      Agregar
    </button>
  </header>

  <div class="card">
    <div class="toolbar">
      <div class="field">
        <label class="label" for="search">Buscar</label>
        <input
          id="search"
          class="input"
          type="text"
          [value]="searchTerm()"
          (input)="onSearchChange($any($event.target).value)"
          placeholder="Escribe para buscar..."
          autocomplete="off"
        />
      </div>
    </div>

    @if (isLoading()) {
      <div class="state state--loading">Cargando productos...</div>
    } @else if (error()) {
      <div class="state state--error">
        <div class="state__title">Error</div>
        <div class="state__message">{{ error()!.message }}</div>
        <button class="btn btn--ghost" type="button" (click)="loadProducts()">
          Reintentar
        </button>
      </div>
    } @else {
      @if (visibleProducts().length === 0) {
        <div class="state">No se encontraron resultados.</div>
      } @else {
        <div class="table">
          <div class="table__head">
            <div>Logo</div>
            <div>Nombre de producto</div>
            <div>
              Descripcion
              <img
                src="assets/icons/info-circle.svg"
                alt="Información"
                class="info-icon"
                title="Información adicional"
              />
            </div>
            <div>
              Fecha de liberacion
              <img
                class="info-icon"
                src="assets/icons/info-circle.svg"
                alt=""
                aria-hidden="true"
              />
            </div>
            <div>
              Fecha de reestructuracion
              <img
                class="info-icon"
                src="assets/icons/info-circle.svg"
                alt=""
                aria-hidden="true"
              />
            </div>
            <div class="table__actions">Acciones</div>
          </div>

          @for (p of visibleProducts(); track p.id) {
            <div class="table__row">
              <div>
                <img
                  class="logo"
                  [src]="p.logo ? p.logo : 'assets/images/200x200.png'"
                  [alt]="p.name"
                />
              </div>
              <div class="strong">{{ p.name }}</div>
              <div class="muted clamp">{{ p.description }}</div>

              <div class="mono">{{ p.date_release }}</div>
              <div class="mono">{{ p.date_revision }}</div>
              <div class="actions">
                <button
                  class="btn btn--link"
                  type="button"
                  (click)="onEdit(p.id)"
                >
                  Editar
                </button>
                <button
                  class="btn btn--link danger"
                  type="button"
                  (click)="onDelete(p.id)"
                >
                  Eliminar
                </button>
              </div>
            </div>
          }
        </div>

        <div class="table__footer">
          <div class="results">{{ totalFilteredCount() }} Resultados</div>

          <div class="field field--small footer__size">
            <label class="label" for="pageSize">Mostrar</label>
            <select
              id="pageSize"
              class="select"
              [value]="pageSize()"
              (change)="onPageSizeChange($any($event.target).value)"
            >
              <option value="5">5</option>
              <option value="10">10</option>
              <option value="20">20</option>
            </select>
          </div>
        </div>
      }
    }
  </div>
</section>
